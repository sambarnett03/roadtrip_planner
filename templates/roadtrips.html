<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Your Roadtrips</title>
    <style>
      body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding: 2rem; max-width: 900px; margin: auto;}
      .card { padding: 1rem; border-radius: 6px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); margin-bottom:1rem; background: #fff; }
      table { width:100%; border-collapse: collapse; }
      th, td { text-align:left; padding:.5rem; border-bottom: 1px solid #eee; }
      input[type="text"] { width: 50%; padding:.4rem; }
      input[type="file"] { padding:.2rem; }
      .actions { display:flex; gap:.5rem; margin-top:.5rem; }
      .muted { color:#666; }
      .small { font-size:0.9rem; color:#555; }
      .no-data { color:#777; padding: .8rem 0; }
      .btn { padding:.4rem .7rem; border-radius:4px; border:1px solid #ccc; background:white; cursor:pointer; }
      .section-title { display:flex; justify-content:space-between; align-items:center; gap:12px; }
      .owner-label { font-size:0.85rem; color:#666; }
      .shared-owner { font-size:0.85rem; color:#888; }
      .pill { background:#f1f5f9; padding:6px 8px; border-radius:999px; font-size:0.85rem; border:1px solid #e2e8f0; }
      .muted-block { margin-top:6px; color:#666; font-size:0.95rem; }
      
      /* Style for the delete button to look like a link */
      .btn-link {
        background: none;
        border: none;
        padding: 0;
        color: #d9534f; /* Reddish color for delete */
        text-decoration: underline;
        cursor: pointer;
        font-family: inherit;
        font-size: inherit;
      }
      .btn-link:hover { text-decoration: none; color: #c9302c; }
    </style>
  </head>
  <body>
    <h1>Your Roadtrips</h1>

    <div class="card">
      <h2>Create a new roadtrip</h2>
      <p class="muted">Enter a name for the roadtrip. A CSV named <em>NAME.csv</em> will be stored.</p>

      <form id="create-form" method="post" action="{{ url_for('create_roadtrip') }}" enctype="multipart/form-data">
        <label>Roadtrip name: <input id="rt-name" name="name" type="text" required></label>
        <div class="actions">
          <button class="btn" type="submit">Create</button>
        </div>
      </form>
    </div>

    <div class="card">
      <div class="section-title">
        <div>
          <h2 style="margin:0 0 .25rem 0;">Your roadtrips</h2>
          <div class="muted-block">Maps you own.</div>
        </div>
        <div class="pill">Owned</div>
      </div>

      {% if owned_roadtrips %}
        <table aria-describedby="owned-roadtrips-table">
          <thead>
            <tr><th>Name</th><th>Created</th><th>Actions</th></tr>
          </thead>
          <tbody>
            {% for r in owned_roadtrips %}
            <tr>
              <td>{{ r.name }}</td>
              <td class="small">{{ r.created_at }}</td>
              <td>
                <a href="{{ url_for('open_map', map_id=r.id) }}">Open</a>
                &nbsp;|&nbsp;
                <a href="{{ url_for('collaborate', map_id=r.id) }}">Share</a>
                &nbsp;|&nbsp;
                <form action="{{ url_for('delete_map') }}" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this map? This cannot be undone.');">
                    <input type="hidden" name="map_id" value="{{ r.id }}">
                    <button type="submit" class="btn-link">Delete</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="no-data">You have no roadtrips yet. Create one above to get started.</p>
      {% endif %}
    </div>

    <div class="card">
      <div class="section-title">
        <div>
          <h2 style="margin:0 0 .25rem 0;">Shared with you</h2>
          <div class="muted-block">Maps other users have shared with you (read or edit access).</div>
        </div>
        <div class="pill">Shared</div>
      </div>

      {% if shared_roadtrips %}
        <table aria-describedby="shared-roadtrips-table">
          <thead>
            <tr><th>Name</th><th>Owner</th><th>Created</th><th>Actions</th></tr>
          </thead>
          <tbody>
            {% for s in shared_roadtrips %}
            <tr>
              <td>{{ s.name }}</td>
              <td class="shared-owner">{{ s.owner }}</td>
              <td class="small">{{ s.created_at }}</td>
              <td>
                <a href="{{ url_for('open_map_shared', owner_id=s.owner, map_id=s.id) }}">Open</a>
                &nbsp;|&nbsp;
                <a href="{{ url_for('collaborate', map_id=s.id) }}">Collaborators</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
      <p class="no-data">No maps have been shared with you.</p>
      {% endif %}
    </div>

    <div>
    <a href="{{ url_for('sign_out') }}">Sign out</a> 
    </div>

  </body>
</html>